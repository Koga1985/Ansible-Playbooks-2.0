---
- name: ans_ctrl__job_cleaner.yml
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    controller_host: "{{ controller_host | default('https://controller.example.mil') }}"
    controller_oauthtoken: "{{ controller_oauthtoken | default(lookup('env','TOWER_TOKEN')) }}"
    validate_certs: "{{ validate_certs | default(true) }}"
    artifacts_dir: "{{ artifacts_dir | default('/tmp/ansible-controller-artifacts') }}"
    apply_changes: "{{ apply_changes | default(false) }}"

  pre_tasks:
    - name: Ensure artifacts directory
      ansible.builtin.file:
        path: "{{ artifacts_dir }}"
        state: directory
        mode: "0755"

tasks:
  - name: Plan job retention
    ansible.builtin.copy:
      dest: "{{ artifacts_dir }}/job_cleaner_plan.json"
      mode: "0644"
      content: "{{ {'max_age_days': max_age_days | default(30), 'max_events': max_events | default(100000)} | to_nice_json }}"

  - name: (Scaffold) â€” implement cleanup via controller_api when approved
    ansible.builtin.debug:
      msg: "Cleanup is destructive. Wire to controller_api with care."

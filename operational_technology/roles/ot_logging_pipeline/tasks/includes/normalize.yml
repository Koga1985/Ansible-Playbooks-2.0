---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Normalize alerts
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/alerts_norm.csv"
    mode: "0644"
    content: |
      time,site,asset,severity,category,message
      {% for a in alerts | default([]) %}
      {{ a.time | default('') }},{{ a.site | default('') }},{{ a.asset | default('') }},{{ a.severity | default('') }},{{ a.category | default('') }},{{ (a.message | default('')) | replace(',',';') }}
      {% endfor %}


---
- name: Load current open findings
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/vuln/findings?status=open&limit={{ page_size }}"
    method: GET
    headers: { Authorization: "Bearer {{ dragos_token }}" }
    return_content: true
    status_code: 200
    validate_certs: "{{ dragos_verify_ssl }}"
  register: _open_now

- name: Determine tickets to close (placeholder)
  ansible.builtin.debug:
    msg: "Compare prior ticket list vs. open findings; close those whose vuln IDs are absent."

- name: Close ServiceNow incidents (placeholder)
  when: itsm.provider | lower == 'servicenow'
  ansible.builtin.debug:
    msg: "PATCH incidents to Closed/Resolved for reconciled items."

- name: Transition Jira issues (placeholder)
  when: itsm.provider | lower == 'jira'
  ansible.builtin.debug:
    msg: "POST transitions to Done/Resolved for reconciled items."
